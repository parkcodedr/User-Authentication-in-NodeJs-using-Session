<!DOCTYPE html>
<html lang="en">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
       </head>
    <body>
    <%- include('nav.ejs') -%>
    <div class="container">
    <form class="col-md-6 offset-3">
  <div class="form-group">
    <label for="email">Email address</label>
    <input type="text" name="email" class="form-control"  aria-describedby="emailHelp">
    <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
  <div class="emailerror text-danger"></div>
  </div>
  <div class="form-group">
    <label for="password">Password</label>
    <input type="password" class="form-control" name="password">
    <div class="passworderror text-danger"></div>
  </div>
 
  <button type="submit" class="btn btn-primary">Register</button>
</form>
    </div>

    <script>
            const form = document.querySelector('form');
            const emailError = document.querySelector('.emailerror');
            const passwordError = document.querySelector('.passworderror');
            
            form.addEventListener('submit', async (e)=>{
                e.preventDefault();
                //reset errors
                emailError.textContent =  '';
                        passwordError.textContent = '';
                const email = form.email.value;
                const password = form.password.value;
                //console.log(email,password);
                try{
                  const result = await fetch('/register', {
                    method:'POST',
                    body:JSON.stringify({email,password}),
                    headers:{'Content-Type':'application/json'}
                  });
                  const data = await result.json();
                  //console.log(data);
                  if(data.errors){
                        emailError.textContent =  data.errors.email;
                        passwordError.textContent = data.errors.password;
                  }else{
                      console.log(result);
                  form.email.value="";
                  form.password.value="";
                  location.assign('/');
                  }
                  
                }catch(err){
                    console.log(err);
                }
                
            });



    </script>
    </body>
</html>